{"version":3,"file":"extension.js","mappings":";;;;;;;;;;AAAa;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,uBAAuB;AACvB,iBAAiB,mBAAO,CAAC,iCAAU;AACnC,iBAAiB,mBAAO,CAAC,iCAAU;AACnC,gBAAgB,mBAAO,CAAC,+BAAS;AACjC,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,wBAAwB,mBAAO,CAAC,oCAAe;AAC/C,4BAA4B,mBAAO,CAAC,sBAAQ;AAC5C,6BAA6B,mBAAO,CAAC,cAAI;AACzC,iCAAiC,mBAAO,CAAC,sBAAQ;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,2DAA2D,yCAAyC;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,+CAA+C;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,4CAA4C;AACrG;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAAwE,mBAAmB;AAC3F;AACA;AACA;AACA,aAAa;AACb;AACA,uGAAuG,KAAK;AAC5G;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA,wHAAwH,KAAK;AAC7H;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,iBAAiB;AACjD;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,uBAAuB;;;;;;;;;;;AC7WV;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kBAAkB,GAAG,sBAAsB,GAAG,WAAW;AACzD,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;;;;;;;;;;;ACnBL;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kBAAkB,GAAG,gBAAgB;AACrC;AACA,4BAA4B,mBAAO,CAAC,sBAAQ;AAC5C,qBAAqB,mBAAO,CAAC,yCAAc;AAC3C,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,yBAAyB,mBAAO,CAAC,iDAAkB;AACnD,gCAAgC,mBAAO,CAAC,oBAAO;AAC/C,gBAAgB,mBAAO,CAAC,+BAAS;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,mDAAmD;AAC3G,uDAAuD,kDAAkD;AACzG;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2FAA2F,gCAAgC;AAC3H;AACA;AACA;AACA,2FAA2F,gCAAgC;AAC3H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACxMa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,iBAAiB,GAAG,+BAA+B,GAAG,2BAA2B,GAAG,+BAA+B,GAAG,8BAA8B,GAAG,uBAAuB,GAAG,iCAAiC,GAAG,8BAA8B,GAAG,iCAAiC,GAAG,0BAA0B,GAAG,+BAA+B,GAAG,6BAA6B,GAAG,sBAAsB,GAAG,2BAA2B,GAAG,mCAAmC,GAAG,sBAAsB,GAAG,mBAAmB,GAAG,uBAAuB;AAC5hB,gBAAgB,mBAAO,CAAC,+BAAS;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,sBAAsB,uBAAuB,uBAAuB;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,YAAY;AACpC;AACA,4BAA4B,WAAW;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,gBAAgB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,qBAAqB,sBAAsB,sBAAsB;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA,CAAC,yBAAyB,0BAA0B,0BAA0B;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,sBAAsB,uBAAuB,uBAAuB;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,WAAW;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;;;;;;;;;;AC7hBJ;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,aAAa,GAAG,qBAAqB,GAAG,mBAAmB,GAAG,2BAA2B,GAAG,kBAAkB;AAC9G,4BAA4B,mBAAO,CAAC,sBAAQ;AAC5C,wBAAwB,mBAAO,CAAC,cAAI;AACpC,wBAAwB,mBAAO,CAAC,cAAI;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,IAAI,IAAI,mCAAmC,UAAU;AAC9E;AACA;AACA;AACA,yBAAyB,IAAI,IAAI,mCAAmC,UAAU;AAC9E;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,IAAI,IAAI,mCAAmC,UAAU;AAC9E;AACA;AACA;AACA,yBAAyB,IAAI,IAAI,mCAAmC,UAAU;AAC9E;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,oBAAoB,SAAS;AAC7B;AACA,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,gBAAgB;AACpC;AACA;AACA;AACA;AACA,aAAa;;;;;;;;;;;AC1GA;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,uBAAuB,GAAG,wBAAwB;AAClD,iCAAiC,mBAAO,CAAC,sBAAQ;AACjD,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,+BAA+B,mBAAO,CAAC,kBAAM;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,UAAU,GAAG,cAAc;AACpD,SAAS;AACT;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,UAAU,GAAG,cAAc;AACpD,SAAS;AACT;AACA;AACA;AACA,uBAAuB;;;;;;;;;;;ACtEV;AACb;AACA;AACA;AACA;AACA,eAAe,oCAAoC;AACnD;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,mBAAmB;AACnB,4BAA4B,mBAAO,CAAC,sBAAQ;AAC5C,wBAAwB,mBAAO,CAAC,cAAI;AACpC,wBAAwB,mBAAO,CAAC,cAAI;AACpC,gBAAgB,mBAAO,CAAC,+BAAS;AACjC,0BAA0B,mBAAO,CAAC,kBAAM;AACxC,iBAAiB,mBAAO,CAAC,iCAAU;AACnC,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,iCAAiC,mBAAO,CAAC,sBAAQ;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,kCAAkC;AAClC;AACA,SAAS;AACT;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;;;;;;;;;;;AC5InB;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":[".././src/connection.ts",".././src/globals.ts",".././src/index.ts",".././src/packet.ts",".././src/utils.ts",".././src/view_terminals.ts",".././src/window.ts","../external commonjs \"child_process\"","../external commonjs \"events\"","../external commonjs \"fs\"","../external commonjs \"https\"","../external commonjs \"os\"","../external commonjs \"path\"","../external commonjs \"vscode\"","../external commonjs \"ws\"","../webpack/bootstrap","../webpack/before-startup","../webpack/startup","../webpack/after-startup"],"sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CraftConnection = void 0;\nconst window_1 = require(\"./window\");\nconst packet_1 = require(\"./packet\");\nconst utils_1 = require(\"./utils\");\nconst globals_1 = require(\"./globals\");\nconst child_process_1 = require(\"child_process\");\nconst vscode = __importStar(require(\"vscode\"));\nconst ws_1 = __importDefault(require(\"ws\"));\nconst events_1 = __importDefault(require(\"events\"));\nclass CraftConnection extends events_1.default {\n    constructor(id) {\n        super();\n        this.id = id;\n        this.gotMessage = false;\n        this.nextDataRequestID = 0;\n        this.dataRequestCallbacks = new Map();\n        this.windows = new Map();\n        this.useBinaryChecksum = false;\n        this.retryChecksum = true;\n        this.supportsFilesystem = false;\n        this.isVersion11 = false;\n        this.isRemote = false;\n    }\n    send(packet) {\n        this.socket.write(packet.wrap({\n            binaryChecksum: this.useBinaryChecksum,\n            extended: this.isVersion11,\n        }));\n    }\n    disconnect() {\n        this.send(packet_1.CraftPacketTerminalChange.new({ type2: packet_1.TerminalChangeType.QUIT }));\n        this.socket.disconnect();\n    }\n    kill() {\n        this.removeWindows();\n        this.socket.kill();\n    }\n    closeWindows() {\n        for (const window of this.windows.values())\n            window.close();\n    }\n    closeWindow(id) {\n        this.windows.get(id)?.close();\n    }\n    openWindow(id) {\n        this.windows.get(id)?.open();\n    }\n    removeWindows() {\n        this.closeWindows();\n        this.windows.clear();\n        this.emit('windows');\n        globals_1.ext.connections.delete(this.id);\n    }\n    removeWindow(id) {\n        this.closeWindow(id);\n        this.windows.delete(id);\n        this.emit('windows');\n    }\n    newWindow(id) {\n        if (!this.windows.has(id)) {\n            const window = new window_1.CraftWindow(this, id);\n            this.windows.set(id, window);\n            window.open();\n            window.on('type_change', () => this.emit('windows'));\n            this.emit('windows');\n            return window;\n        }\n    }\n    processChunk(chunk) {\n        if (typeof chunk === \"string\")\n            chunk = Buffer.from(chunk, \"utf8\");\n        if (this.dataContinuation) {\n            chunk = Buffer.concat([this.dataContinuation, chunk]);\n            delete this.dataContinuation;\n        }\n        while (chunk.length > 0) {\n            const start = chunk.indexOf(33); // Seek to '!'\n            if (start === -1)\n                return;\n            chunk = chunk.subarray(start);\n            const magic = chunk.subarray(0, 4).toString();\n            let off;\n            if (magic === \"!CPC\")\n                off = 8;\n            else if (magic === \"!CPD\" && this.isVersion11)\n                off = 16;\n            else\n                return;\n            const size = parseInt(chunk.subarray(4, off).toString(), 16);\n            if (size > chunk.length - off - 8) {\n                this.dataContinuation = chunk;\n                return;\n            }\n            const data = Buffer.from(chunk.subarray(off, size + off).toString(), \"base64\");\n            const goodChecksum = parseInt(chunk.subarray(size + off, size + off + 8).toString(), 16);\n            const dataChecksum = (0, utils_1.crc32)(this.useBinaryChecksum ? data.toString(\"binary\") : chunk.subarray(off, size + off).toString());\n            chunk = chunk.subarray(size + off + 8);\n            if (goodChecksum !== dataChecksum) {\n                globals_1.ext.log.appendLine(\"Bad checksum: expected \" + goodChecksum.toString(16) + \", got \" + dataChecksum.toString(16));\n                if (this.retryChecksum) {\n                    const otherDataChecksum = (0, utils_1.crc32)(this.useBinaryChecksum ? chunk.subarray(off, size + off).toString() : data.toString(\"binary\"));\n                    if (goodChecksum !== otherDataChecksum) {\n                        this.retryChecksum = false;\n                        continue;\n                    }\n                    globals_1.ext.log.appendLine(\"Checksum matched in other mode, switching.\");\n                    this.useBinaryChecksum = !this.useBinaryChecksum;\n                }\n                else {\n                    continue;\n                }\n            }\n            this.retryChecksum = false;\n            this.handlePacket(packet_1.CraftPacket.from(data));\n        }\n    }\n    handlePacket(packet) {\n        switch (packet.type) {\n            case packet_1.CraftPacketType.TERMINAL_CONTENTS:\n                this.handleTerminalContentsPacket(packet);\n                break;\n            case packet_1.CraftPacketType.TERMINAL_CHANGE:\n                this.handleTerminalChangePacket(packet);\n                break;\n            case packet_1.CraftPacketType.SHOW_MESSAGE:\n                this.handleShowMessagePacket(packet);\n                break;\n            case packet_1.CraftPacketType.VERSION_SUPPORT:\n                this.handleVersionSupportPacket(packet);\n                break;\n            case packet_1.CraftPacketType.FILE_RESPONSE:\n                this.handleFileResponsePacket(packet);\n                break;\n            case packet_1.CraftPacketType.FILE_DATA:\n                this.handleFileDataPacket(packet);\n                break;\n        }\n        this.gotMessage = true;\n    }\n    handleTerminalContentsPacket(packet) {\n        this.windows.get(packet.window)?.updateTerm(packet);\n    }\n    handleTerminalChangePacket(packet) {\n        if (!this.gotMessage)\n            this.send(packet_1.CraftPacketVersionSupport.new({ binaryChecksum: true, supportFilesystem: true }));\n        switch (packet.type2) {\n            case packet_1.TerminalChangeType.UPDATE:\n                if (this.windows.has(packet.window)) {\n                    this.windows.get(packet.window).updateTerm(packet);\n                }\n                else {\n                    this.newWindow(packet.window).updateTerm(packet);\n                }\n                break;\n            case packet_1.TerminalChangeType.CLOSE:\n                if (this.windows.has(packet.window)) {\n                    this.removeWindow(packet.window);\n                }\n                break;\n            case packet_1.TerminalChangeType.QUIT:\n                if (this.isRemote) {\n                    this.socket.write(\"\\n\");\n                    this.socket.disconnect();\n                }\n                else {\n                    this.socket.kill();\n                }\n                return;\n        }\n    }\n    handleShowMessagePacket(packet) {\n        switch (packet.kind) {\n            case \"unknown\":\n            case \"info\":\n                vscode.window.showInformationMessage(\"CraftOS-PC: \" + packet.title + \": \" + packet.message);\n                break;\n            case \"warning\":\n                vscode.window.showWarningMessage(\"CraftOS-PC: \" + packet.title + \": \" + packet.message);\n                break;\n            case \"error\":\n                vscode.window.showErrorMessage(\"CraftOS-PC: \" + packet.title + \": \" + packet.message);\n                break;\n        }\n    }\n    handleVersionSupportPacket(packet) {\n        this.isVersion11 = true;\n        this.useBinaryChecksum = packet.binaryChecksum;\n        this.supportsFilesystem = packet.supportFilesystem;\n    }\n    handleFileResponsePacket(packet) {\n        if (!this.dataRequestCallbacks.has(packet.id)) {\n            globals_1.ext.log.appendLine(\"Got stray response for request ID \" + packet.id + \", ignoring.\");\n            return;\n        }\n        const callback = this.dataRequestCallbacks.get(packet.id);\n        if (packet.isError)\n            callback(undefined, packet.error || \"Operation failed\");\n        else\n            callback(packet);\n    }\n    handleFileDataPacket(packet) {\n        if (!this.dataRequestCallbacks.has(packet.id)) {\n            globals_1.ext.log.appendLine(\"Got stray response for request ID \" + packet.id + \", ignoring.\");\n            return;\n        }\n        const callback = this.dataRequestCallbacks.get(packet.id);\n        if (packet.isError)\n            callback(undefined, packet.data.toString());\n        else\n            callback(packet);\n    }\n    queueDataRequest(packet, data) {\n        const requestID = this.nextDataRequestID;\n        this.nextDataRequestID = (this.nextDataRequestID + 1) & 0xff;\n        const isWrite = (packet.type2 & 0xf1) === 0x11;\n        packet.id = requestID;\n        this.send(packet);\n        if (isWrite) {\n            this.send(packet_1.CraftPacketFileData.new({ id: requestID, data, window: packet.window }));\n        }\n        return new Promise((resolve, reject) => {\n            const tid = setTimeout(() => {\n                this.dataRequestCallbacks.delete(requestID);\n                reject(\"Timeout\");\n            });\n            this.dataRequestCallbacks.set(requestID, (data, err) => {\n                clearTimeout(tid);\n                this.dataRequestCallbacks.delete(requestID);\n                if (data)\n                    resolve(data);\n                else\n                    reject(err);\n            });\n        });\n    }\n    static fromProcess(id, extraArgs) {\n        const exePath = (0, utils_1.getExecutable)();\n        if (!exePath)\n            return null;\n        const connection = new CraftConnection(id);\n        globals_1.ext.connections.set(id, connection);\n        connection.isRemote = false;\n        const args = [\"--raw\"];\n        const additionalArguments = (0, utils_1.getExtensionSetting)(\"additionalArguments\");\n        if (additionalArguments !== null) {\n            args.push(...additionalArguments.split(\" \"));\n        }\n        const dataPath = (0, utils_1.getExtensionSetting)(\"dataPath\");\n        if (dataPath !== null) {\n            args.push(\"-d\", dataPath);\n        }\n        if (extraArgs) {\n            args.push(...extraArgs);\n        }\n        globals_1.ext.log.appendLine(\"Running: \" + exePath + \" \" + args.join(\" \"));\n        try {\n            const process = (0, child_process_1.spawn)(exePath, args, { windowsHide: true });\n            process.on(\"error\", () => {\n                vscode.window.showErrorMessage(\"The CraftOS-PC worker process could not be launched. Check the path to the executable in the settings.\");\n                connection.removeWindows();\n            });\n            process.on(\"exit\", (code) => {\n                vscode.window.showInformationMessage(`The CraftOS-PC worker process exited with code ${code}.`);\n                connection.removeWindows();\n            });\n            process.on(\"disconnect\", () => {\n                vscode.window.showErrorMessage(`The CraftOS-PC worker process was disconnected from the window.`);\n                connection.removeWindows();\n            });\n            process.on(\"close\", () => {\n                //vscode.window.showInformationMessage(`The CraftOS-PC worker process closed all IO streams with code ${code}.`)\n                connection.removeWindows();\n            });\n            process.stdout.on(\"data\", (data) => connection.processChunk(data));\n            process.stderr.on(\"data\", (data) => globals_1.ext.log.appendLine(data.toString()));\n            connection.socket = {\n                disconnect: () => process.disconnect(),\n                kill: () => process.kill(),\n                write: (data) => process.stdin.write(data, \"utf8\"),\n            };\n        }\n        catch (e) {\n            vscode.window.showErrorMessage(\"The CraftOS-PC worker process could not be launched. Check the path to the executable in the settings.\");\n            globals_1.ext.log.appendLine(e);\n            return;\n        }\n        connection.send(packet_1.CraftPacketVersionSupport.new({\n            binaryChecksum: true,\n            supportFilesystem: true,\n        }));\n        vscode.window.showInformationMessage(\"A new CraftOS-PC worker process has been started.\");\n        connection.newWindow(0);\n        return connection;\n    }\n    static fromWebsocket(id, url) {\n        const connection = new CraftConnection(id);\n        globals_1.ext.connections.set(id, connection);\n        connection.isRemote = true;\n        globals_1.ext.log.appendLine(\"Connecting to: \" + url);\n        const rawSocket = new ws_1.default(url);\n        connection.socket = {\n            disconnect: () => rawSocket.close(),\n            kill: () => rawSocket.close(),\n            write: (data) => {\n                for (let i = 0; i < data.length; i += 65530)\n                    rawSocket.send(data.substring(i, Math.min(i + 65530, data.length)));\n            },\n        };\n        rawSocket.on(\"open\", () => {\n            connection.send(packet_1.CraftPacketVersionSupport.new({\n                binaryChecksum: true,\n                supportFilesystem: true,\n                requestAllWindows: true,\n            }));\n            vscode.window.showInformationMessage(\"Successfully connected to the WebSocket server.\");\n        });\n        rawSocket.on(\"error\", (e) => {\n            if (e.message.match(\"certificate has expired\"))\n                vscode.window\n                    .showErrorMessage(\"A bug in VS Code is causing the connection to fail. Please go to https://www.craftos-pc.cc/docs/remote#certificate-has-expired-error to fix it.\", \"Open Page\", \"OK\")\n                    .then((res) => {\n                    if (res === \"OK\")\n                        return;\n                    vscode.env.openExternal(vscode.Uri.parse(\"https://www.craftos-pc.cc/docs/remote#certificate-has-expired-error\"));\n                });\n            else\n                vscode.window.showErrorMessage(\"An error occurred while connecting to the server: \" + e.message);\n            connection.removeWindows();\n        });\n        rawSocket.on(\"close\", () => {\n            vscode.window.showInformationMessage(\"Disconnected from the WebSocket server.\");\n            connection.removeWindows();\n        });\n        rawSocket.on(\"message\", (data) => connection.processChunk(Array.isArray(data) ? Buffer.concat(data) : Buffer.from(data)));\n        return connection;\n    }\n}\nexports.CraftConnection = CraftConnection;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FindWindow = exports.FindConnection = exports.ext = void 0;\nexports.ext = {\n    connections: new Map(),\n};\nfunction FindConnection(globalID) {\n    const sep = globalID.indexOf(\"@\");\n    if (sep !== -1)\n        globalID = globalID.substring(sep + 1);\n    return exports.ext.connections.get(globalID);\n}\nexports.FindConnection = FindConnection;\nfunction FindWindow(globalID) {\n    const sep = globalID.indexOf(\"@\");\n    if (sep === -1)\n        return;\n    return exports.ext.connections.get(globalID.substring(sep + 1))?.windows.get(parseInt(globalID.substring(0, sep)));\n}\nexports.FindWindow = FindWindow;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.deactivate = exports.activate = void 0;\nconsole.log(\"preimport\");\nconst vscode = __importStar(require(\"vscode\"));\nconst connection_1 = require(\"./connection\");\nconst globals_1 = require(\"./globals\");\nconst view_terminals_1 = require(\"./view_terminals\");\nconst https_1 = __importDefault(require(\"https\"));\nconst utils_1 = require(\"./utils\");\nconst commands = {};\nfunction activate(context) {\n    globals_1.ext.context = context;\n    globals_1.ext.log = vscode.window.createOutputChannel(\"CraftOS-PC\");\n    globals_1.ext.computer_provider = new view_terminals_1.ComputerProvider();\n    globals_1.ext.monitor_provider = new view_terminals_1.MonitorProvider();\n    vscode.window.createTreeView(\"craftos-computers\", { treeDataProvider: globals_1.ext.computer_provider });\n    vscode.window.createTreeView(\"craftos-monitors\", { treeDataProvider: globals_1.ext.monitor_provider });\n    for (const name in commands) {\n        context.subscriptions.push(vscode.commands.registerCommand(name, commands[name]));\n    }\n}\nexports.activate = activate;\nfunction deactivate() {\n    for (const connection of globals_1.ext.connections.values()) {\n        connection.kill();\n    }\n}\nexports.deactivate = deactivate;\nfunction connectToProcess(extraArgs) {\n    const nextID = [...globals_1.ext.connections.keys()].reduce((prev, id) => (id.startsWith(\"local-\") ? Math.max(parseInt(id.substring(6)), prev) : prev), 0);\n    if (nextID > 0) {\n        extraArgs = extraArgs || [];\n        extraArgs.push('--id', nextID.toFixed(0));\n    }\n    const connection = connection_1.CraftConnection.fromProcess(\"local-\" + nextID, extraArgs);\n    connection.on(\"windows\", () => {\n        globals_1.ext.computer_provider.fire(null);\n        globals_1.ext.monitor_provider.fire(null);\n    });\n    console.log(connection);\n}\nfunction connectToWebSocket(url) {\n    const connection = connection_1.CraftConnection.fromWebsocket(\"websocket\", url);\n    connection.on(\"windows\", () => {\n        globals_1.ext.computer_provider.fire(null);\n        globals_1.ext.monitor_provider.fire(null);\n    });\n    console.log(connection);\n}\ncommands[\"craftos-pc.open\"] = () => connectToProcess();\nfunction validateURL(str) {\n    try {\n        let url = new URL(str);\n        return url.protocol.toLowerCase() == \"ws:\" || url.protocol.toLowerCase() == \"wss:\";\n    }\n    catch (e) {\n        return false;\n    }\n}\ncommands[\"craftos-pc.open-websocket\"] = async (url) => {\n    if (typeof url === \"string\")\n        return connectToWebSocket(url);\n    let wsHistory = globals_1.ext.context.globalState.get(\"JackMacWindows.craftos-pc/websocket-history\", [\"\"]);\n    let quickPick = vscode.window.createQuickPick();\n    quickPick.items = wsHistory.map((val) => {\n        return { label: val };\n    });\n    quickPick.title = \"Enter the WebSocket URL:\";\n    quickPick.placeholder = \"wss://\";\n    quickPick.canSelectMany = false;\n    quickPick.onDidChangeValue(() => {\n        wsHistory[0] = quickPick.value;\n        quickPick.items = wsHistory.map((val) => {\n            return { label: val };\n        });\n    });\n    quickPick.onDidAccept(() => {\n        let str = quickPick.selectedItems[0].label;\n        if (!validateURL(str))\n            vscode.window.showErrorMessage(\"The URL you entered is not valid.\");\n        else {\n            wsHistory[0] = str;\n            if (wsHistory.slice(1).includes(str))\n                wsHistory.splice(wsHistory.slice(1).indexOf(str) + 1, 1);\n            wsHistory.unshift(\"\");\n            globals_1.ext.context.globalState.update(\"JackMacWindows.craftos-pc/websocket-history\", wsHistory);\n            connectToWebSocket(str);\n        }\n    });\n    quickPick.show();\n};\ncommands[\"craftos-pc.clear-history\"] = () => globals_1.ext.context.globalState.update(\"JackMacWindows.craftos-pc/websocket-history\", [\"\"]);\nlet didShowBetaMessage = false;\ncommands[\"craftos-pc.open-new-remote\"] = () => {\n    if (!didShowBetaMessage) {\n        vscode.window.showWarningMessage(\"remote.craftos-pc.cc is currently in beta. Be aware that things may not work as expected. If you run into issues, please report them [on GitHub](https://github.com/MCJack123/remote.craftos-pc.cc/issues). If things break, use Shift+Ctrl+P (Shift+Cmd+P on Mac), then type 'reload window' and press Enter.\");\n        didShowBetaMessage = true;\n    }\n    https_1.default\n        .get(\"https://remote.craftos-pc.cc/new\", (res) => {\n        if (Math.floor(res.statusCode / 100) !== 2) {\n            vscode.window.showErrorMessage(\"Could not connect to remote.craftos-pc.cc: HTTP \" + res.statusCode);\n            res.resume();\n            return;\n        }\n        res.setEncoding(\"utf8\");\n        let id = \"\";\n        res.on(\"data\", (chunk) => (id += chunk));\n        res.on(\"end\", () => {\n            vscode.env.clipboard.writeText(\"wget run https://remote.craftos-pc.cc/server.lua \" + id);\n            vscode.window.showInformationMessage(\"A command has been copied to the clipboard. Paste that into the ComputerCraft computer to establish the connection.\");\n            connectToWebSocket(\"wss://remote.craftos-pc.cc/\" + id);\n        });\n    })\n        .on(\"error\", (e) => {\n        if (e.message.match(\"certificate has expired\"))\n            vscode.window\n                .showErrorMessage(\"A bug in VS Code is causing the connection to fail. Please go to https://www.craftos-pc.cc/docs/remote#certificate-has-expired-error to fix it.\", \"Open Page\", \"OK\")\n                .then((res) => {\n                if (res === \"OK\")\n                    return;\n                vscode.env.openExternal(vscode.Uri.parse(\"https://www.craftos-pc.cc/docs/remote#certificate-has-expired-error\"));\n            });\n        else\n            vscode.window.showErrorMessage(\"Could not connect to remote.craftos-pc.cc: \" + e.message);\n    });\n};\ncommands[\"craftos-pc.open-window\"] = (obj) => {\n    if (typeof obj === \"object\")\n        return (0, globals_1.FindWindow)(obj.globalID)?.open();\n    vscode.window\n        .showInputBox({\n        prompt: \"Enter the window ID:\",\n        validateInput: (str) => (isNaN(parseInt(str)) ? \"Invalid number\" : null),\n    })\n        .then((id) => (0, globals_1.FindWindow)(id)?.open());\n};\ncommands[\"craftos-pc.open-config\"] = () => {\n    if ((0, utils_1.getDataPath)() === null) {\n        vscode.window.showErrorMessage(\"Please set the path to the CraftOS-PC data directory manually.\");\n        return;\n    }\n    vscode.commands.executeCommand(\"vscode.open\", vscode.Uri.file((0, utils_1.getDataPath)() + \"/config/global.json\"));\n};\ncommands['craftos-pc.close'] = () => {\n    for (const connection of globals_1.ext.connections.values()) {\n        connection.disconnect();\n    }\n};\ncommands[\"craftos-pc.close-window\"] = async (obj) => {\n    const id = typeof obj === 'object' ? obj.globalID : await vscode.window.showInputBox({ prompt: \"Enter the window ID:\" });\n    (0, globals_1.FindWindow)(id)?.close();\n};\ncommands[\"craftos-pc.kill\"] = async (obj) => {\n    const id = typeof obj === 'object' ? obj.globalID : await vscode.window.showInputBox({ prompt: \"Enter the window ID:\" });\n    (0, globals_1.FindConnection)(id)?.kill();\n};\ncommands[\"craftos-pc.run-file\"] = path => {\n    if (!path) {\n        if (vscode.window.activeTextEditor === undefined || vscode.window.activeTextEditor.document.uri.scheme !== \"file\") {\n            vscode.window.showErrorMessage(\"Please open or save a file on disk before using this command.\");\n            return;\n        }\n        path = vscode.window.activeTextEditor.document.uri.fsPath;\n    }\n    else if (typeof path === \"object\" && path instanceof vscode.Uri) {\n        if (path.scheme !== \"file\") {\n            vscode.window.showErrorMessage(\"Please open or save a file on disk before using this command.\");\n            return;\n        }\n        path = path.fsPath;\n    }\n    return connectToProcess([\"--script\", path]);\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.newPacket = exports.CraftPacketSpeakerSound = exports.CraftPacketFileData = exports.CraftPacketFileResponse = exports.CraftPacketFileRequest = exports.FileRequestType = exports.CraftPacketVersionSupport = exports.CraftPacketShowMessage = exports.CraftPacketTerminalChange = exports.TerminalChangeType = exports.CraftPacketGenericEvent = exports.CraftPacketMouseEvent = exports.MouseEventType = exports.CraftPacketKeyEvent = exports.CraftPacketTerminalContents = exports.CraftPacketRaw = exports.CraftPacket = exports.CraftPacketType = void 0;\nconst utils_1 = require(\"./utils\");\nvar CraftPacketType;\n(function (CraftPacketType) {\n    CraftPacketType[CraftPacketType[\"TERMINAL_CONTENTS\"] = 0] = \"TERMINAL_CONTENTS\";\n    CraftPacketType[CraftPacketType[\"KEY_EVENT\"] = 1] = \"KEY_EVENT\";\n    CraftPacketType[CraftPacketType[\"MOUSE_EVENT\"] = 2] = \"MOUSE_EVENT\";\n    CraftPacketType[CraftPacketType[\"GENERIC_EVENT\"] = 3] = \"GENERIC_EVENT\";\n    CraftPacketType[CraftPacketType[\"TERMINAL_CHANGE\"] = 4] = \"TERMINAL_CHANGE\";\n    CraftPacketType[CraftPacketType[\"SHOW_MESSAGE\"] = 5] = \"SHOW_MESSAGE\";\n    CraftPacketType[CraftPacketType[\"VERSION_SUPPORT\"] = 6] = \"VERSION_SUPPORT\";\n    CraftPacketType[CraftPacketType[\"FILE_REQUEST\"] = 7] = \"FILE_REQUEST\";\n    CraftPacketType[CraftPacketType[\"FILE_RESPONSE\"] = 8] = \"FILE_RESPONSE\";\n    CraftPacketType[CraftPacketType[\"FILE_DATA\"] = 9] = \"FILE_DATA\";\n    CraftPacketType[CraftPacketType[\"SPEAKER_SOUND\"] = 10] = \"SPEAKER_SOUND\";\n})(CraftPacketType || (exports.CraftPacketType = CraftPacketType = {}));\nclass CraftPacket {\n    constructor() {\n        this.window = 0;\n    }\n    static from(buf) {\n        let packet = null;\n        switch (buf[0]) {\n            case CraftPacketType.TERMINAL_CONTENTS:\n                packet = new CraftPacketTerminalContents();\n                break;\n            case CraftPacketType.TERMINAL_CHANGE:\n                packet = new CraftPacketTerminalChange();\n                break;\n            case CraftPacketType.SHOW_MESSAGE:\n                packet = new CraftPacketShowMessage();\n                break;\n            case CraftPacketType.VERSION_SUPPORT:\n                packet = new CraftPacketVersionSupport();\n                break;\n            case CraftPacketType.FILE_RESPONSE:\n                packet = new CraftPacketFileResponse();\n                break;\n            case CraftPacketType.FILE_DATA:\n                packet = new CraftPacketFileData();\n                break;\n            case CraftPacketType.SPEAKER_SOUND:\n                packet = new CraftPacketSpeakerSound();\n                break;\n        }\n        if (packet) {\n            packet.read(buf);\n        }\n        return packet;\n    }\n    read(buf) {\n        this.type = buf[0];\n        this.window = buf[1];\n    }\n    write() {\n        const buf = Buffer.alloc(this.length + 2);\n        buf.fill(0);\n        buf[0] = this.type;\n        buf[1] = this.window;\n        return buf;\n    }\n    get length() {\n        return 2;\n    }\n    wrap(options) {\n        const data = this.write();\n        const b64 = data.toString(\"base64\");\n        if (b64.length <= 0xffff) {\n            return (\"!CPC\" +\n                b64.length.toString(16).padStart(4, \"0\") +\n                b64 +\n                (0, utils_1.crc32)(options?.binaryChecksum ? data.toString(\"binary\") : b64)\n                    .toString(16)\n                    .padStart(8, \"0\") +\n                \"\\n\");\n        }\n        else {\n            if (!options?.extended)\n                throw new Error(\"Packet is too large\");\n            return (\"!CPD\" +\n                b64.length.toString(16).padStart(12, \"0\") +\n                b64 +\n                (0, utils_1.crc32)(options?.binaryChecksum ? data.toString(\"binary\") : b64)\n                    .toString(16)\n                    .padStart(8, \"0\") +\n                \"\\n\");\n        }\n    }\n}\nexports.CraftPacket = CraftPacket;\nclass CraftPacketRaw extends CraftPacket {\n    write() {\n        const buf = super.write();\n        this.data.copy(buf, 2);\n        return buf;\n    }\n    get length() {\n        return 2 + this.data.byteLength;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketRaw = CraftPacketRaw;\n// Server --> Client\nclass CraftPacketTerminalContents extends CraftPacket {\n    static from(buf) {\n        const packet = new CraftPacketTerminalContents();\n        packet.read(buf);\n        return packet;\n    }\n    readRLE(target, width, height, buf) {\n        let offset = 0;\n        let c = 0;\n        let n = 0;\n        for (let y = 0; y < height; y++) {\n            target[y] = [];\n            for (let x = 0; x < width; x++) {\n                while (n <= 0) {\n                    c = buf[offset++];\n                    n = buf[offset++];\n                }\n                target[y][x] = c;\n                n--;\n            }\n        }\n        return offset;\n    }\n    read(buf) {\n        super.read(buf);\n        this.mode = buf[0x02];\n        this.blink = buf[0x03] === 1;\n        this.width = buf[0x04] | (buf[0x05] << 8);\n        this.height = buf[0x06] | (buf[0x07] << 8);\n        this.cursorX = buf[0x08] | (buf[0x09] << 8);\n        this.cursorY = buf[0x0a] | (buf[0x0b] << 8);\n        this.grayscale = buf[0x0c] === 1;\n        let bufCursor = 0x10;\n        if (this.mode === 0) {\n            this.screen = [];\n            this.colors = [];\n            bufCursor += this.readRLE(this.screen, this.width, this.height, buf.subarray(bufCursor));\n            bufCursor += this.readRLE(this.colors, this.width, this.height, buf.subarray(bufCursor));\n        }\n        else if (this.mode === 1 || this.mode === 2) {\n            this.pixels = [];\n            bufCursor += this.readRLE(this.pixels, this.width * 6, this.height * 9, buf.subarray(bufCursor));\n        }\n        this.palette = [];\n        const numPalette = this.mode < 2 ? 16 : 256;\n        for (let i = 0; i < numPalette; i++) {\n            this.palette[i] = {\n                r: buf[bufCursor++],\n                g: buf[bufCursor++],\n                b: buf[bufCursor++],\n            };\n        }\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketTerminalContents = CraftPacketTerminalContents;\n// Server <-- Client\nclass CraftPacketKeyEvent extends CraftPacket {\n    constructor() {\n        super(...arguments);\n        this.data = 0;\n        this.isDown = false;\n        this.isHeld = false;\n        this.isControl = false;\n    }\n    write() {\n        const buf = super.write();\n        let flags = (this.isDown ? 1 : 0) | (this.isHeld ? 2 : 0) | (this.isControl ? 4 : 0);\n        let data = this.data;\n        if (typeof data === \"string\") {\n            data = data.charCodeAt(0);\n            flags |= 8;\n        }\n        buf[0x02] = data;\n        buf[0x03] = flags;\n        return buf;\n    }\n    get length() {\n        return 4;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketKeyEvent = CraftPacketKeyEvent;\nvar MouseEventType;\n(function (MouseEventType) {\n    MouseEventType[MouseEventType[\"MOUSE_DOWN\"] = 0] = \"MOUSE_DOWN\";\n    MouseEventType[MouseEventType[\"MOUSE_UP\"] = 1] = \"MOUSE_UP\";\n    MouseEventType[MouseEventType[\"MOUSE_SCROLL\"] = 2] = \"MOUSE_SCROLL\";\n    MouseEventType[MouseEventType[\"MOUSE_DRAG\"] = 3] = \"MOUSE_DRAG\";\n})(MouseEventType || (exports.MouseEventType = MouseEventType = {}));\n// Server <-- Client\nclass CraftPacketMouseEvent extends CraftPacket {\n    constructor() {\n        super(...arguments);\n        this.button = 0;\n        this.x = 0;\n        this.y = 0;\n    }\n    write() {\n        const buf = super.write();\n        buf[0x02] = this.event;\n        buf[0x03] = this.event === MouseEventType.MOUSE_SCROLL ? (this.scroll === \"up\" ? 0 : 1) : this.button;\n        buf.writeUint32LE(this.x, 0x04);\n        buf.writeUint32LE(this.y, 0x08);\n        return buf;\n    }\n    get length() {\n        return 12;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketMouseEvent = CraftPacketMouseEvent;\n// Server <-- Client\n// TODO\nclass CraftPacketGenericEvent extends CraftPacket {\n    write() {\n        const buf = super.write();\n        return buf;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketGenericEvent = CraftPacketGenericEvent;\nvar TerminalChangeType;\n(function (TerminalChangeType) {\n    TerminalChangeType[TerminalChangeType[\"UPDATE\"] = 0] = \"UPDATE\";\n    TerminalChangeType[TerminalChangeType[\"CLOSE\"] = 1] = \"CLOSE\";\n    TerminalChangeType[TerminalChangeType[\"QUIT\"] = 2] = \"QUIT\";\n})(TerminalChangeType || (exports.TerminalChangeType = TerminalChangeType = {}));\n// Server <-> Client\nclass CraftPacketTerminalChange extends CraftPacket {\n    constructor() {\n        super(...arguments);\n        this.type2 = TerminalChangeType.UPDATE;\n        this.id = 0;\n        this.width = 0;\n        this.height = 0;\n        this.title = \"\";\n    }\n    read(buf) {\n        super.read(buf);\n        this.type2 = buf[0x02];\n        this.id = buf[0x03];\n        this.width = buf.readUInt16LE(0x04);\n        this.height = buf.readUInt16LE(0x06);\n        const titleEnd = buf.indexOf(0, 0x08);\n        this.title = new TextDecoder(\"utf8\").decode(buf.subarray(0x08, titleEnd));\n    }\n    write() {\n        const buf = super.write();\n        buf[0x02] = this.type2;\n        buf[0x03] = this.id;\n        buf.writeUInt16LE(this.width, 0x04);\n        buf.writeUInt16LE(this.height, 0x06);\n        return buf;\n    }\n    get length() {\n        return 9;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketTerminalChange = CraftPacketTerminalChange;\n// Server --> Client\nclass CraftPacketShowMessage extends CraftPacket {\n    constructor() {\n        super(...arguments);\n        this.kind = \"unknown\";\n        this.title = \"\";\n        this.message = \"\";\n    }\n    read(buf) {\n        super.read(buf);\n        switch (buf.readUInt32LE(0x02)) {\n            case 0x10:\n                this.kind = \"error\";\n                break;\n            case 0x20:\n                this.kind = \"warning\";\n                break;\n            case 0x40:\n                this.kind = \"info\";\n                break;\n            default:\n                this.kind = \"unknown\";\n        }\n        const titleEnd = buf.indexOf(0, 0x06);\n        const messageEnd = buf.indexOf(0, titleEnd + 1);\n        const decoder = new TextDecoder(\"utf8\");\n        this.title = decoder.decode(buf.subarray(0x06, titleEnd));\n        this.message = decoder.decode(buf.subarray(titleEnd + 1, messageEnd));\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketShowMessage = CraftPacketShowMessage;\n// Server <-> Client\nclass CraftPacketVersionSupport extends CraftPacket {\n    constructor() {\n        super(...arguments);\n        this.binaryChecksum = false;\n        this.supportFilesystem = false;\n        this.requestAllWindows = false;\n        this.supportSpeaker = false;\n    }\n    read(buf) {\n        super.read(buf);\n        const flags = buf.readUInt16LE(0x02);\n        this.binaryChecksum = (flags & 0x01) !== 0;\n        this.supportFilesystem = (flags & 0x02) !== 0;\n        this.requestAllWindows = (flags & 0x04) !== 0;\n        this.supportSpeaker = (flags & 0x08) !== 0;\n    }\n    write() {\n        const buf = super.write();\n        buf.writeUInt16LE((this.binaryChecksum ? 1 : 0) |\n            (this.supportFilesystem ? 2 : 0) |\n            (this.requestAllWindows ? 4 : 0) |\n            (this.supportSpeaker ? 8 : 0), 0x02);\n        return buf;\n    }\n    get length() {\n        return 4;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketVersionSupport = CraftPacketVersionSupport;\nvar FileRequestType;\n(function (FileRequestType) {\n    FileRequestType[FileRequestType[\"EXISTS\"] = 0] = \"EXISTS\";\n    FileRequestType[FileRequestType[\"IS_DIR\"] = 1] = \"IS_DIR\";\n    FileRequestType[FileRequestType[\"IS_READONLY\"] = 2] = \"IS_READONLY\";\n    FileRequestType[FileRequestType[\"GET_SIZE\"] = 3] = \"GET_SIZE\";\n    FileRequestType[FileRequestType[\"GET_DRIVE\"] = 4] = \"GET_DRIVE\";\n    FileRequestType[FileRequestType[\"GET_CAPACITY\"] = 5] = \"GET_CAPACITY\";\n    FileRequestType[FileRequestType[\"GET_FREE_SPACE\"] = 6] = \"GET_FREE_SPACE\";\n    FileRequestType[FileRequestType[\"LIST\"] = 7] = \"LIST\";\n    FileRequestType[FileRequestType[\"ATTRIBUTES\"] = 8] = \"ATTRIBUTES\";\n    FileRequestType[FileRequestType[\"FIND\"] = 9] = \"FIND\";\n    FileRequestType[FileRequestType[\"MAKE_DIR\"] = 10] = \"MAKE_DIR\";\n    FileRequestType[FileRequestType[\"DELETE\"] = 11] = \"DELETE\";\n    FileRequestType[FileRequestType[\"COPY\"] = 12] = \"COPY\";\n    FileRequestType[FileRequestType[\"MOVE\"] = 13] = \"MOVE\";\n    FileRequestType[FileRequestType[\"OPEN\"] = 16] = \"OPEN\";\n})(FileRequestType || (exports.FileRequestType = FileRequestType = {}));\n// Server <-- Client\nclass CraftPacketFileRequest extends CraftPacket {\n    set path(val) {\n        this._path = new TextEncoder().encode(val);\n    }\n    set path2(val) {\n        this._path2 = new TextEncoder().encode(val);\n    }\n    write() {\n        const buf = super.write();\n        let t = this.type2;\n        if (t === FileRequestType.OPEN) {\n            t |= (this.isWrite ? 1 : 0) | (this.isAppend ? 2 : 0) | (this.isBinary ? 4 : 0);\n        }\n        buf[0x02] = t;\n        buf[0x03] = this.id;\n        if (this._path) {\n            Buffer.from(this._path).copy(buf, 0x04);\n            buf[0x04 + this._path.byteLength] = 0;\n            if (this._path2) {\n                Buffer.from(this._path2).copy(buf, 0x05 + this._path.byteLength);\n                buf[0x05 + this._path.byteLength + this._path2.byteLength] = 0;\n            }\n        }\n        return buf;\n    }\n    get length() {\n        return 6 + (this._path ? this._path.byteLength : 0) + (this._path2 ? this._path2.byteLength : 0);\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketFileRequest = CraftPacketFileRequest;\n// Server --> Client\nclass CraftPacketFileResponse extends CraftPacket {\n    read(buf) {\n        super.read(buf);\n        this.type2 = buf[0x02];\n        this.id = buf[0x03];\n        switch (Math.min(this.type2, 16)) {\n            case FileRequestType.MAKE_DIR:\n            case FileRequestType.DELETE:\n            case FileRequestType.COPY:\n            case FileRequestType.MOVE:\n            case FileRequestType.OPEN:\n                const msgEnd = buf.indexOf(0, 0x04);\n                this.success = msgEnd === 0x04;\n                this.isError = !this.success;\n                if (!this.success)\n                    this.error = new TextDecoder(\"utf8\").decode(buf.subarray(0x04, msgEnd));\n                break;\n            case FileRequestType.EXISTS:\n            case FileRequestType.IS_DIR:\n            case FileRequestType.IS_READONLY:\n                this.booleanResult = buf[0x04] === 2 ? null : !!buf[0x04];\n                this.isError = this.booleanResult === null;\n                break;\n            case FileRequestType.GET_SIZE:\n            case FileRequestType.GET_CAPACITY:\n            case FileRequestType.GET_FREE_SPACE:\n                this.integerResult = buf.readUInt32LE(0x04);\n                if (this.integerResult === 0xffffffff)\n                    this.integerResult = null;\n                this.isError = this.integerResult === null;\n                break;\n            case FileRequestType.GET_DRIVE:\n                const strEnd = buf.indexOf(0, 0x04);\n                this.stringResult = strEnd === 0x04 ? null : new TextDecoder(\"utf8\").decode(buf.subarray(0x04, strEnd));\n                this.isError = this.stringResult === null;\n                break;\n            case FileRequestType.LIST:\n            case FileRequestType.FIND:\n                const count = buf.readUInt32LE(0x04);\n                if (count === 0xffffffff) {\n                    this.listResult = null;\n                    this.isError = true;\n                    break;\n                }\n                this.isError = false;\n                let offset = 0x08;\n                this.listResult = [];\n                const decoder = new TextDecoder(\"utf8\");\n                for (let i = 0; i < count; i++) {\n                    const end = buf.indexOf(0, offset);\n                    this.listResult[i] = decoder.decode(buf.subarray(offset, end));\n                    offset = end + 1;\n                }\n                break;\n            case FileRequestType.ATTRIBUTES:\n                if (buf[0x1a] === 0) {\n                    const size = buf.readUInt32LE(0x04);\n                    const created = buf.readBigUint64LE(0x08).toString();\n                    const modified = buf.readBigUint64LE(0x10).toString();\n                    const isDir = !!buf[0x18];\n                    const isReadonly = !!buf[0x19];\n                    this.attributes = {\n                        size,\n                        created,\n                        modified,\n                        isDir,\n                        isReadonly,\n                    };\n                    this.isError = false;\n                }\n                else {\n                    this.attributes = null;\n                    this.isError = buf[0x1a] === 2;\n                }\n                break;\n        }\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketFileResponse = CraftPacketFileResponse;\n// Server <-> Client\nclass CraftPacketFileData extends CraftPacket {\n    constructor() {\n        super(...arguments);\n        this.isError = false;\n    }\n    read(buf) {\n        super.read(buf);\n        this.isError = !!buf[0x02];\n        this.id = buf[0x03];\n        const length = buf.readUInt32LE(0x04);\n        this.data = buf.subarray(0x08, 0x08 + length);\n    }\n    write() {\n        const buf = super.write();\n        buf[0x02] = this.isError ? 1 : 0;\n        buf[0x03] = this.id;\n        buf.writeUInt32LE(this.data.byteLength);\n        this.data.copy(buf, 0x08);\n        return buf;\n    }\n    get length() {\n        return 8 + this.data.byteLength;\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketFileData = CraftPacketFileData;\n// Server --> Client\n// TODO\nclass CraftPacketSpeakerSound extends CraftPacket {\n    read(buf) {\n        super.read(buf);\n    }\n    static new(data) {\n        return newPacket(this, data);\n    }\n}\nexports.CraftPacketSpeakerSound = CraftPacketSpeakerSound;\nconst classToType = new Map();\nclassToType.set(CraftPacketTerminalContents, CraftPacketType.TERMINAL_CONTENTS);\nclassToType.set(CraftPacketKeyEvent, CraftPacketType.KEY_EVENT);\nclassToType.set(CraftPacketMouseEvent, CraftPacketType.MOUSE_EVENT);\nclassToType.set(CraftPacketGenericEvent, CraftPacketType.GENERIC_EVENT);\nclassToType.set(CraftPacketTerminalChange, CraftPacketType.TERMINAL_CHANGE);\nclassToType.set(CraftPacketShowMessage, CraftPacketType.SHOW_MESSAGE);\nclassToType.set(CraftPacketVersionSupport, CraftPacketType.VERSION_SUPPORT);\nclassToType.set(CraftPacketFileRequest, CraftPacketType.FILE_REQUEST);\nclassToType.set(CraftPacketFileResponse, CraftPacketType.FILE_RESPONSE);\nclassToType.set(CraftPacketFileData, CraftPacketType.FILE_DATA);\nclassToType.set(CraftPacketSpeakerSound, CraftPacketType.SPEAKER_SOUND);\nfunction newPacket(clazz, data) {\n    const t = new clazz();\n    for (const key in data) {\n        t[key] = data[key];\n    }\n    if (classToType.has(clazz))\n        t.type = classToType.get(clazz);\n    return t;\n}\nexports.newPacket = newPacket;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.crc32 = exports.getExecutable = exports.getDataPath = exports.getExtensionSetting = exports.getSetting = void 0;\nconst vscode = __importStar(require(\"vscode\"));\nconst os = __importStar(require(\"os\"));\nconst fs = __importStar(require(\"fs\"));\nfunction getSetting(name) {\n    const config = vscode.workspace.getConfiguration(name);\n    if (config.get(\"all\") !== null && config.get(\"all\") !== \"\")\n        return config.get(\"all\");\n    else if (os.platform() === \"win32\")\n        return config.get(\"windows\").replace(/%([^%]+)%/g, (_, n) => process.env[n] || \"%\" + n + \"%\");\n    else if (os.platform() === \"darwin\")\n        return config.get(\"mac\")\n            .replace(/\\$(\\w+)/g, (_, n) => process.env[n] || \"$\" + n)\n            .replace(/\\${([^}]+)}/g, (_, n) => process.env[n] || \"${\" + n + \"}\");\n    else if (os.platform() === \"linux\")\n        return config.get(\"linux\")\n            .replace(/\\$(\\w+)/g, (_, n) => process.env[n] || \"$\" + n)\n            .replace(/\\${([^}]+)}/g, (_, n) => process.env[n] || \"${\" + n + \"}\");\n    else\n        return null;\n}\nexports.getSetting = getSetting;\nfunction getExtensionSetting(name) {\n    return vscode.workspace.getConfiguration(\"craftos-pc\").get(name);\n}\nexports.getExtensionSetting = getExtensionSetting;\nfunction getDataPath() {\n    const config = vscode.workspace.getConfiguration(\"craftos-pc\");\n    if (config.get(\"dataPath\") !== null && config.get(\"dataPath\") !== \"\")\n        return config.get(\"dataPath\");\n    else if (os.platform() === \"win32\")\n        return \"%appdata%\\\\CraftOS-PC\".replace(/%([^%]+)%/g, (_, n) => process.env[n] || \"%\" + n + \"%\");\n    else if (os.platform() === \"darwin\")\n        return \"$HOME/Library/Application Support/CraftOS-PC\"\n            .replace(/\\$(\\w+)/g, (_, n) => process.env[n] || \"$\" + n)\n            .replace(/\\${([^}]+)}/g, (_, n) => process.env[n] || \"${\" + n + \"}\");\n    else if (os.platform() === \"linux\")\n        return \"$HOME/.local/craftos-pc\"\n            .replace(/\\$(\\w+)/g, (_, n) => process.env[n] || \"$\" + n)\n            .replace(/\\${([^}]+)}/g, (_, n) => process.env[n] || \"${\" + n + \"}\");\n    else\n        return null;\n}\nexports.getDataPath = getDataPath;\nfunction getExecutable() {\n    let path = getSetting(\"craftos-pc.executablePath\");\n    if (path !== null && fs.existsSync(path))\n        return path;\n    if (os.platform() === \"win32\") {\n        path = \"%localappdata%\\\\Programs\\\\CraftOS-PC\\\\CraftOS-PC_console.exe\".replace(/%([^%]+)%/g, (_, n) => process.env[n] || \"%\" + n + \"%\");\n        if (fs.existsSync(path))\n            return path;\n    }\n    if (path !== null && os.platform() === \"win32\" && fs.existsSync(path.replace(\"_console\", \"\"))) {\n        vscode.window.showErrorMessage(\"The CraftOS-PC installation is missing the console version, which is required for this extension to function. Please run the installer again, making sure to check the 'Console build for raw mode' box.\");\n        return null;\n    }\n    vscode.window.showErrorMessage(\"The CraftOS-PC executable could not be found. Check the path in the settings. If you haven't installed CraftOS-PC yet, [download it from the official website.](https://www.craftos-pc.cc)\");\n    return null;\n}\nexports.getExecutable = getExecutable;\nlet crcTable = null;\nfunction makeCRCTable() {\n    let c;\n    let crcTable = [];\n    for (let n = 0; n < 256; n++) {\n        c = n;\n        for (let k = 0; k < 8; k++)\n            c = c & 1 ? 0xedb88320 ^ (c >>> 1) : c >>> 1;\n        crcTable[n] = c;\n    }\n    return crcTable;\n}\nfunction crc32(str) {\n    crcTable = crcTable || makeCRCTable();\n    let crc = 0 ^ -1;\n    for (let i = 0; i < str.length; i++) {\n        crc = (crc >>> 8) ^ crcTable[(crc ^ str.charCodeAt(i)) & 0xff];\n    }\n    return (crc ^ -1) >>> 0;\n}\nexports.crc32 = crc32;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MonitorProvider = exports.ComputerProvider = void 0;\nconst vscode_1 = __importDefault(require(\"vscode\"));\nconst globals_1 = require(\"./globals\");\nconst path_1 = __importDefault(require(\"path\"));\nclass ComputerProvider extends vscode_1.default.EventEmitter {\n    constructor() {\n        super(...arguments);\n        this.onDidChangeTreeData = this.event;\n    }\n    getTreeItem(element) {\n        const r = new vscode_1.default.TreeItem(element.title);\n        r.iconPath = vscode_1.default.Uri.file(path_1.default.join(globals_1.ext.context.extensionPath, \"media/computer.svg\"));\n        r.command = {\n            command: \"craftos-pc.open-window\",\n            title: \"CraftOS-PC: Open Window\",\n            arguments: [element],\n        };\n        r.tooltip = element.globalID;\n        if ((0, globals_1.FindConnection)(element.globalID)?.supportsFilesystem)\n            r.contextValue = \"data-available\";\n        return r;\n    }\n    getChildren(element) {\n        if (element)\n            return null;\n        return [...globals_1.ext.connections.values()]\n            .map((connection) => [...connection.windows.values()]\n            .filter((window) => !window.isMonitor)\n            .map((window) => ({\n            title: window.term?.title || \"CraftOS-PC Computer\",\n            globalID: `${window.id}@${connection.id}`,\n        })))\n            .flat(1);\n    }\n}\nexports.ComputerProvider = ComputerProvider;\nclass MonitorProvider extends vscode_1.default.EventEmitter {\n    constructor() {\n        super(...arguments);\n        this.onDidChangeTreeData = this.event;\n    }\n    getTreeItem(element) {\n        const r = new vscode_1.default.TreeItem(element.title);\n        r.iconPath = vscode_1.default.Uri.file(path_1.default.join(globals_1.ext.context.extensionPath, \"media/monitor.svg\"));\n        r.command = {\n            command: \"craftos-pc.open-window\",\n            title: \"CraftOS-PC: Open Window\",\n            arguments: [element],\n        };\n        r.tooltip = element.globalID;\n        return r;\n    }\n    getChildren(element) {\n        if (element)\n            return null;\n        return [...globals_1.ext.connections.values()]\n            .map((connection) => [...connection.windows.values()]\n            .filter((window) => window.isMonitor)\n            .map((window) => ({\n            title: window.term?.title || \"CraftOS-PC Computer\",\n            globalID: `${window.id}@${connection.id}`,\n        })))\n            .flat(1);\n    }\n}\nexports.MonitorProvider = MonitorProvider;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CraftWindow = void 0;\nconst vscode = __importStar(require(\"vscode\"));\nconst os = __importStar(require(\"os\"));\nconst fs = __importStar(require(\"fs\"));\nconst utils_1 = require(\"./utils\");\nconst path = __importStar(require(\"path\"));\nconst packet_1 = require(\"./packet\");\nconst globals_1 = require(\"./globals\");\nconst events_1 = __importDefault(require(\"events\"));\nfunction loadFont() {\n    const customFont = vscode.workspace.getConfiguration(\"craftos-pc.customFont\");\n    let fontPath = customFont.get(\"path\");\n    if (fontPath === \"hdfont\") {\n        const execPath = (0, utils_1.getSetting)(\"craftos-pc.executablePath\");\n        if (os.platform() === \"win32\")\n            fontPath = execPath.replace(/[\\/\\\\][^\\/\\\\]+$/, \"/\") + \"hdfont.bmp\";\n        else if (os.platform() === \"darwin\" && execPath.indexOf(\"MacOS/craftos\") !== -1)\n            fontPath = execPath.replace(/MacOS\\/[^\\/]+$/, \"\") + \"Resources/hdfont.bmp\";\n        else if (os.platform() === \"darwin\" ||\n            (os.platform() === \"linux\" && !fs.existsSync(\"/usr/share/craftos/hdfont.bmp\")))\n            fontPath = \"/usr/local/share/craftos/hdfont.bmp\";\n        else if (os.platform() === \"linux\")\n            fontPath = \"/usr/share/craftos/hdfont.bmp\";\n        if (!fs.existsSync(fontPath)) {\n            vscode.window.showWarningMessage(\"The path to the HD font could not be found; the default font will be used instead. Please set the path to the HD font manually.\");\n            fontPath = null;\n        }\n    }\n    return fontPath;\n}\nclass CraftWindow extends events_1.default {\n    constructor(parent, id) {\n        super();\n        this.parent = parent;\n        this.id = id;\n        this.isMonitor = false;\n    }\n    open() {\n        if (this.panel) {\n            this.panel.reveal();\n            return;\n        }\n        const fontPath = loadFont();\n        this.panel = vscode.window.createWebviewPanel(\"craftos-pc\", \"CraftOS-PC Terminal\", (vscode.window.activeTextEditor && vscode.window.activeTextEditor.viewColumn) || vscode.ViewColumn.One, {\n            enableScripts: true,\n            retainContextWhenHidden: true,\n            localResourceRoots: fontPath !== null && fontPath !== \"\"\n                ? [vscode.Uri.file(fontPath.replace(/[\\/\\\\][^\\/\\\\]*$/, \"\"))]\n                : null,\n        });\n        globals_1.ext.context.subscriptions.push(this.panel);\n        this.panel.iconPath = vscode.Uri.file(path.join(globals_1.ext.context.extensionPath, this.isMonitor ? \"media/monitor.svg\" : \"media/computer.svg\"));\n        this.panel.webview.html = fs.readFileSync(path.join(globals_1.ext.context.extensionPath, \"index.html\"), \"utf8\");\n        this.panel.webview.onDidReceiveMessage((message) => {\n            if (typeof message !== \"object\")\n                return;\n            if (message.getFontPath === true) {\n                if (fontPath !== null && fontPath !== \"\")\n                    this.panel.webview.postMessage({\n                        fontPath: this.panel.webview.asWebviewUri(vscode.Uri.file(fontPath)).toString(),\n                    });\n                return;\n            }\n            this.parent.send(packet_1.CraftPacketRaw.new({\n                type: message.type,\n                window: this.id,\n                data: Buffer.from(message.data, \"hex\"),\n            }));\n        });\n        this.panel.onDidChangeViewState((e) => {\n            if (e.webviewPanel.active && this.term !== undefined) {\n                this.updateTerm({});\n            }\n        });\n        this.panel.onDidDispose(() => delete this.panel);\n        if (this.term) {\n            this.updateTerm({});\n        }\n    }\n    close() {\n        this.panel.dispose();\n        delete this.panel;\n    }\n    updateTerm(term) {\n        const prevIsMonitor = this.isMonitor;\n        if (\"title\" in term) {\n            this.isMonitor = term.title.indexOf(\"Monitor\") !== -1;\n            if (!this.isMonitor) {\n                const m = term.title.match(/Computer (\\d+)$/);\n                if (m) {\n                    this.computerID = parseInt(m[1]);\n                }\n            }\n        }\n        if (\"id\" in term) {\n            if (term.id > 0) {\n                this.computerID = term.id - 1;\n                this.isMonitor = false;\n            }\n        }\n        if (prevIsMonitor !== this.isMonitor) {\n            this.emit('type_change', this.isMonitor);\n        }\n        if (!this.term)\n            this.term = {};\n        Object.assign(this.term, term);\n        if (this.panel) {\n            this.panel.webview.postMessage(this.term);\n            this.panel.title = this.term.title || \"CraftOS-PC Terminal\";\n        }\n    }\n}\nexports.CraftWindow = CraftWindow;\n","module.exports = require(\"child_process\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"https\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"vscode\");","module.exports = require(\"ws\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/index.ts\");\n",""],"names":[],"sourceRoot":""}